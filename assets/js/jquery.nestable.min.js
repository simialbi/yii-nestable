/*
 Nestable jQuery Plugin - Copyright (c) 2012 David Bushell - http://dbushell.com/
 Modified for yii2-nestable - Copyright (c) 2015 Arno Slatius - http://slatius.nl/

 Dual-licensed under the BSD or MIT licenses
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(d,k,f){d instanceof String&&(d=String(d));for(var l=d.length,m=0;m<l;m++){var g=d[m];if(k.call(f,g,m,d))return{i:m,v:g}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,k,f){d!=Array.prototype&&d!=Object.prototype&&(d[k]=f.value)};
$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(d,k,f,l){if(k){f=$jscomp.global;d=d.split(".");for(l=0;l<d.length-1;l++){var m=d[l];m in f||(f[m]={});f=f[m]}d=d[d.length-1];l=f[d];k=k(l);k!=l&&null!=k&&$jscomp.defineProperty(f,d,{configurable:!0,writable:!0,value:k})}};
$jscomp.polyfill("Array.prototype.find",function(d){return d?d:function(d,f){return $jscomp.findInternal(this,d,f).v}},"es6","es3");
(function(d,k,f,l){function m(b,c){this.w=d(k);this.el=d(b);this.options=d.extend({},t,c);this.init()}var g="ontouchstart"in k,n=function(){var b=f.createElement("div"),c=f.documentElement;if(!("pointerEvents"in b.style))return!1;b.style.pointerEvents="auto";b.style.pointerEvents="x";c.appendChild(b);var a=k.getComputedStyle&&"auto"===k.getComputedStyle(b,"").pointerEvents;c.removeChild(b);return!!a}(),p=g?"touchstart":"mousedown",q=g?"touchmove":"mousemove",r=g?"touchend":"mouseup",u=g?"touchcancel":
"mouseup",t={listNodeName:"ol",itemNodeName:"li",rootClass:"dd",listClass:"dd-list",itemClass:"dd-item",dragClass:"dd-dragel",handleClass:"dd-handle",collapsedClass:"dd-collapsed",placeClass:"dd-placeholder",noDragClass:"dd-nodrag",emptyClass:"dd-empty",activeClass:"dd-active",expandBtnHTML:'<button data-action="expand" type="button">Expand</button>',collapseBtnHTML:'<button data-action="collapse" type="button">Collapse</button>',initCollapsed:!1,group:0,maxDepth:5,threshold:20,url:"",modelClass:null};
m.prototype={init:function(){var b=this;b.reset();b.el.data("nestable-group",this.options.group);b.placeEl=d('<div class="'+b.options.placeClass+'"/>');d.each(this.el.find(b.options.itemNodeName),function(a,c){b.setParent(d(c))});b.el.on("click","button",function(a){if(!b.dragEl&&(g||0===a.button)){var c=d(a.currentTarget);a=c.data("action");c=c.parent(b.options.itemNodeName);"collapse"===a&&b.collapseItem(c);"expand"===a&&b.expandItem(c)}});var c=function(a){var c=d(a.target);if(!c.hasClass(b.options.handleClass)){if(c.closest("."+
b.options.noDragClass).length)return;c=c.closest("."+b.options.handleClass)}!c.length||b.dragEl||!g&&0!==a.button||g&&1!==a.touches.length||(a.preventDefault(),b.dragStart(g?a.touches[0]:a))},a=function(a){b.dragEl&&(a.preventDefault(),b.dragMove(g?a.touches[0]:a))},e=function(a){b.dragEl&&(a.preventDefault(),b.dragStop(g?a.touches[0]:a))};g?(b.el[0].addEventListener(p,c,!1),k.addEventListener(q,a,!1),k.addEventListener(r,e,!1),k.addEventListener(u,e,!1)):(b.el.on(p,c),b.w.on(q,a),b.w.on(r,e));this.options.initCollapsed&&
(b.collapseAll(),c=b.el.find("."+this.options.activeClass),c.length&&c.parents("."+this.options.collapsedClass).each(function(){b.expandItem(d(this))}))},serialize:function(){var b=this,c=function(a,e){var h=[];a.children(b.options.itemNodeName).each(function(){var a=d(this),f=d.extend({},a.data());a=a.children(b.options.listNodeName);a.length&&(f.children=c(a,e+1));h.push(f)});return h};return c(b.el.find(b.options.listNodeName).first(),0)},serialise:function(){return this.serialize()},reset:function(){this.mouse=
{offsetX:0,offsetY:0,startX:0,startY:0,lastX:0,lastY:0,nowX:0,nowY:0,distX:0,distY:0,dirAx:0,dirX:0,dirY:0,lastDirX:0,lastDirY:0,distAxX:0,distAxY:0};this.moving=!1;this.dragRootEl=this.dragEl=null;this.dragDepth=0;this.hasNewRoot=!1;this.pointEl=null},expandItem:function(b){b.removeClass(this.options.collapsedClass);b.children('[data-action="expand"]').hide();b.children('[data-action="collapse"]').show();b.children(this.options.listNodeName).show()},collapseItem:function(b){b.children(this.options.listNodeName).length&&
(b.addClass(this.options.collapsedClass),b.children('[data-action="collapse"]').hide(),b.children('[data-action="expand"]').show(),b.children(this.options.listNodeName).hide())},expandAll:function(){var b=this;b.el.find(b.options.itemNodeName).each(function(){b.expandItem(d(this))})},collapseAll:function(){var b=this;b.el.find(b.options.itemNodeName).each(function(){b.collapseItem(d(this))})},setParent:function(b){b.children(this.options.listNodeName).length&&(b.prepend(d(this.options.expandBtnHTML)),
b.prepend(d(this.options.collapseBtnHTML)));b.children('[data-action="expand"]').hide()},unsetParent:function(b){b.removeClass(this.options.collapsedClass);b.children("[data-action]").remove();b.children(this.options.listNodeName).remove()},dragStart:function(b){var c=this.mouse,a=d(b.target),e=a.closest(this.options.itemNodeName),h=d("."+this.options.handleClass,e).position()||{left:0,top:0};this.placeEl.css("height",e.height());c.offsetX=b.offsetX!==l?b.offsetX:b.pageX-a.offset().left;c.offsetY=
b.offsetY!==l?b.offsetY:b.pageY-a.offset().top;c.startX=c.lastX=b.pageX;c.startY=c.lastY=b.pageY;this.dragRootEl=this.el;this.dragEl=d(f.createElement(this.options.listNodeName)).addClass(this.options.listClass+" "+this.options.dragClass);this.dragEl.css("width",e.width());e.after(this.placeEl);e[0].parentNode.removeChild(e[0]);e.appendTo(this.dragEl);d(f.body).append(this.dragEl);this.dragEl.css({left:b.pageX-c.offsetX-h.left,top:b.pageY-c.offsetY-h.top});a=this.dragEl.find(this.options.itemNodeName);
for(b=0;b<a.length;b++)c=d(a[b]).parents(this.options.listNodeName).length,c>this.dragDepth&&(this.dragDepth=c)},dragStop:function(){var b=this.dragEl.children(this.options.itemNodeName).first();b[0].parentNode.removeChild(b[0]);this.placeEl.replaceWith(b);this.dragEl.remove();var c=this.options.url,a=b.prev(this.options.itemNodeName),e=b.next(this.options.itemNodeName),h=b.parents(this.options.itemNodeName);h.length?a.length?(c+="/after",a=a.data("id")):e.length?(c+="/before",a=e.data("id")):(c+=
"/append",a=h.data("id")):(c+="/root",a=a.data("id"));this.options.url&&this.options.modelClass&&d.ajax({url:c,context:f.body,data:{id:b.data("id"),context:a,modelClass:this.options.modelClass}}).fail(function(a){k.alert(a.responseText)});this.el.trigger("change");this.hasNewRoot&&this.dragRootEl.trigger("change");this.reset()},dragMove:function(b){var c=this.options,a=this.mouse;var e=d("."+this.options.handleClass,this.dragEl).first().position()||{left:0,top:0};this.dragEl.css({left:b.pageX-a.offsetX-
e.left,top:b.pageY-a.offsetY-e.top});a.lastX=a.nowX;a.lastY=a.nowY;a.nowX=b.pageX;a.nowY=b.pageY;a.distX=a.nowX-a.lastX;a.distY=a.nowY-a.lastY;a.lastDirX=a.dirX;a.lastDirY=a.dirY;a.dirX=0===a.distX?0:0<a.distX?1:-1;a.dirY=0===a.distY?0:0<a.distY?1:-1;e=Math.abs(a.distX)>Math.abs(a.distY)?1:0;if(a.moving){a.dirAx!==e?(a.distAxX=0,a.distAxY=0):(a.distAxX+=Math.abs(a.distX),0!==a.dirX&&a.dirX!==a.lastDirX&&(a.distAxX=0),a.distAxY+=Math.abs(a.distY),0!==a.dirY&&a.dirY!==a.lastDirY&&(a.distAxY=0));a.dirAx=
e;if(a.dirAx&&a.distAxX>=c.threshold){a.distAxX=0;var h=this.placeEl.prev(c.itemNodeName);if(0<a.distX&&h.length&&!h.hasClass(c.collapsedClass)){e=h.find(c.listNodeName).last();var g=this.placeEl.parents(c.listNodeName).length;g+this.dragDepth<=c.maxDepth&&(e.length?(e=h.children(c.listNodeName).last(),e.append(this.placeEl)):(e=d("<"+c.listNodeName+"/>").addClass(c.listClass),e.append(this.placeEl),h.append(e),this.setParent(h)))}0>a.distX&&(e=this.placeEl.next(c.itemNodeName),e.length||(g=this.placeEl.parent(),
this.placeEl.closest(c.itemNodeName).after(this.placeEl),g.children().length||this.unsetParent(g.parent())))}e=!1;n||(this.dragEl[0].style.visibility="hidden");this.pointEl=d(f.elementFromPoint(b.pageX-f.body.scrollLeft,b.pageY-(k.pageYOffset||f.documentElement.scrollTop)));n||(this.dragEl[0].style.visibility="visible");this.pointEl.hasClass(c.handleClass)&&(this.pointEl=this.pointEl.parent(c.itemNodeName));if(this.pointEl.hasClass(c.emptyClass))e=!0;else if(!this.pointEl.length||!this.pointEl.hasClass(c.itemClass)){h=
this.pointEl.closest("."+c.itemClass);if(!h.length)return;this.pointEl=h}h=this.pointEl.closest("."+c.rootClass);var l=this.dragRootEl.data("nestable-id")!==h.data("nestable-id");a.dirAx&&!l&&!e||l&&c.group!==h.data("nestable-group")||(g=this.dragDepth-1+this.pointEl.parents(c.listNodeName).length,g>c.maxDepth||(b=b.pageY<this.pointEl.offset().top+this.pointEl.height()/2,g=this.placeEl.parent(),e?(e=d(f.createElement(c.listNodeName)).addClass(c.listClass),e.append(this.placeEl),this.pointEl.replaceWith(e)):
b?this.pointEl.before(this.placeEl):this.pointEl.after(this.placeEl),g.children().length||this.unsetParent(g.parent()),this.dragRootEl.find(c.itemNodeName).length||this.dragRootEl.append('<div class="'+c.emptyClass+'"/>'),l&&(this.dragRootEl=h,this.hasNewRoot=this.el[0]!==this.dragRootEl[0])))}else a.dirAx=e,a.moving=!0}};d.fn.nestable=function(){for(var b=this,c,a=[],e=0;e<arguments.length;e++)0===e&&(c=arguments[e]),0<e&&a.push(arguments[e]);this.each(function(){var e=d(this).data("nestable");e?
"string"===typeof c&&"function"===typeof e[c]&&(b=e[c].apply(e,a)):(d(this).data("nestable",new m(this,c)),d(this).data("nestable-id",(new Date).getTime()))});return b||this}})(window.jQuery,window,document);
